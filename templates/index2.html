<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Control Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: row;
        }

        #preview-container {
            margin-right: 20px;
        }

        #preview {
            width: 640px;
            height: auto;
            border: 1px solid black;
        }

        #joystick {
            width: 200px;
            height: 200px;
            background-color: #ccc;
            border-radius: 50%;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: 20px;
            cursor: pointer;
        }

        #handle {
            width: 20px;
            height: 20px;
            background-color: red;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        #zoomRange {
            width: 100%;
            margin-top: 20px;
        }
		
		#vertical-sliders {
			display: flex;
			flex-direction: column;
			margin-left: 20px; 
		}

		#slider {
			-webkit-appearance: slider-vertical;
			width: 20px;
			height: 200px;
			margin-bottom: 10px;
			writing-mode: bt-lr;
			appearance: slider-vertical;
		}

    </style>
</head>
<body>
    <h1>Camera Control Interface</h1>
    <div id="container">
        <div id="preview-container">
            <h2>Preview</h2>
            <img id="preview" src="" alt="Preview">
        </div>
        <div id="joystick">
            <div id="handle"></div>
        </div>
		<div class="vertical-sliders">
			<input type="range" min="0" max="255" value="0" class="slider" id="redSlider">
			<input type="range" min="0" max="255" value="0" class="slider" id="greenSlider">
			<input type="range" min="0" max="255" value="0" class="slider" id="blueSlider">
		</div>
    </div>
    <input type="range" min="0" max="100" value="50" id="zoomRange">

	<script>
		// Function to update the preview image
		function updatePreview() {
			var preview = document.getElementById('preview');
			var xhr = new XMLHttpRequest();
			xhr.open('GET', '/get_frame', true);
			xhr.responseType = 'blob';
			xhr.onload = function () {
				if (this.status === 200) {
					var blob = this.response;
					var url = URL.createObjectURL(blob);
					preview.src = url;
				}
			};
			xhr.send();
		}

		// Function to send joystick position data to the Flask server
		function sendJoystickPositionToServer(position) {
			var xhr = new XMLHttpRequest();
			xhr.open('POST', '/control_joystick', true);
			xhr.setRequestHeader('Content-Type', 'application/json');
			xhr.send(JSON.stringify(position));
		}

		// Function to round joystick position
		function roundJoystickPosition(position) {
			if (position > 0) {
				return 1;
			} else if (position < 0) {
				return -1;
			} else {
				return 0;
			}
		}
		
		// Function to send zoom level data to the Flask server
		function sendZoomLevelToServer(zoomLevel) {
			var xhr = new XMLHttpRequest();
			xhr.open('POST', '/adjust_zoom', true);
			xhr.setRequestHeader('Content-Type', 'application/json');
			xhr.send(JSON.stringify({ zoomLevel: zoomLevel }));
		}

		// Function to handle joystick movement
		function handleJoystickMove(event) {
			var joystick = document.getElementById('joystick');
			var handle = document.getElementById('handle');
			var rect = joystick.getBoundingClientRect();
			var centerX = rect.left + rect.width / 2;
			var centerY = rect.top + rect.height / 2;
			var offsetX = event.clientX - centerX;
			var offsetY = event.clientY - centerY;
			var distance = Math.sqrt(offsetX * offsetX + offsetY * offsetY);
			var maxDistance = rect.width / 2;
			var angle = Math.atan2(offsetY, offsetX);
			var newX, newY;
			if (distance > maxDistance) {
				newX = maxDistance * Math.cos(angle);
				newY = maxDistance * Math.sin(angle);
			} else {
				newX = offsetX;
				newY = offsetY;
			}
			handle.style.left = newX + rect.width / 2 + 'px'; // Adjust for container width
			handle.style.top = newY + rect.height / 2 + 'px'; // Adjust for container height
			// Send joystick position data to the Flask server
			var joystickPosition = {
				x: roundJoystickPosition(newX / maxDistance), // Normalize position to [-1, 1]
				y: roundJoystickPosition(newY / maxDistance)
			};
			sendJoystickPositionToServer(joystickPosition);
		}

		// Function to handle zoom level change
		function handleZoomChange(event) {
			console.log("Zoom level changed:", event.target.value);
			var zoomLevel = event.target.value;
			// Send zoom level data to the Flask server
			sendZoomLevelToServer(zoomLevel);
		}

		// Attach joystick event listeners
		var joystick = document.getElementById('joystick');
		joystick.addEventListener('mousedown', function (event) {
			handleJoystickMove(event);
			document.addEventListener('mousemove', handleJoystickMove);
		});
		document.addEventListener('mouseup', function () {
			document.removeEventListener('mousemove', handleJoystickMove);
			// Reset joystick position
			var handle = document.getElementById('handle');
			handle.style.left = '50%';
			handle.style.top = '50%';
			// Send reset joystick position to the Flask server
			var joystickPosition = { x: 0, y: 0 };
			sendJoystickPositionToServer(joystickPosition);
		});

		// Attach zoom change event listener
		var zoomRange = document.getElementById('zoomRange');
		zoomRange.addEventListener('input', handleZoomChange);

		// Update the preview image periodically
		setInterval(updatePreview, 200);
	</script>






</body>
</html>
